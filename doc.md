# Обзор проекта RoutineApp (TodoApp: SQLite + Tkinter)

Этот проект — настольное приложение “менеджер задач” на **Python + Tkinter** с хранением данных в **SQLite**.  
GUI позволяет добавлять/редактировать/удалять задачи, менять статус, назначать приоритет и категорию, а также фильтровать список.

---

## 1) Структура проекта

Корень: `RoutineApp (2)/`

- `todo_app/` — основной код приложения
  - `main_gui.py` — весь пользовательский интерфейс (Tkinter), диалоги, виджеты, главный класс приложения
  - `todo.db` — файл SQLite базы данных (локальное хранилище задач и категорий)
  - `core/` — “бизнес-логика” и слой данных
    - `models.py` — модель данных `Task` (dataclass)
    - `database.py` — класс `TodoDatabase` (CRUD + фильтрация + категории)
    - `__init__.py` — пустой (просто помечает пакет)
- `run.sh` / `run.bat` — скрипты запуска под Linux/Windows (проверяют Python, ставят `tkcalendar`, запускают GUI)
- `documentation_code.md` — уже имеющаяся подробная документация по коду (по сути “справочник” по классам/методам)
- `venv/`, `temp/`, `scripts/` — вспомогательные директории (окружение/временное/прочее)

---

## 2) Ключевые модули и ответственность

### 2.1 `todo_app/core/models.py`
Содержит dataclass `Task` — это “структура данных” задачи, которая переносится между БД и интерфейсом.

**Основные поля:**
- `id` — первичный ключ в SQLite
- `title`, `description`
- `category`
- `status` (`"не выполнено"`, `"в процессе"`, `"выполнено"`)
- `priority` (`"срочно"`, `"важно"`, `"обычно"`, `"нет"`)
- `due_date` — срок (строкой)
- `created_at` — время создания

**Методы:**
- `get_priority_color()` — возвращает цвет (RGBA) по приоритету/статусу (для подсветки в UI)
- `is_overdue()` — проверяет “просрочена ли задача” (если есть `due_date` и задача не выполнена)

Важно: `is_overdue()` ожидает формат даты `"%Y-%m-%d %H:%M"`. Если где-то хранится `"%Y-%m-%d %H:%M:%S"`, проверка просрочки может не сработать (ошибка парсинга → `False`).

---

### 2.2 `todo_app/core/database.py`
Класс `TodoDatabase` — слой работы с SQLite. Он:
- создаёт/обновляет схему таблиц (включая простую “миграцию” при появлении новых колонок),
- выполняет все операции с задачами и категориями,
- преобразует строки из SQLite в объекты `Task`.

**Таблицы:**
- `tasks`: `id`, `title`, `description`, `completed`, `category`, `status`, `priority`, `due_date`, `created_at`
- `categories`: `id`, `name` (уникальное)

**Основные методы:**
- `init_db()` — гарантирует, что таблицы существуют; при необходимости делает миграцию `tasks -> tasks_new -> tasks`
- `add_task(...)` — вставка задачи (и `INSERT OR IGNORE` категории)
- `update_task(...)` — обновление заголовка/описания/категории/приоритета/срока
- `update_task_status(task_id, status)` — меняет статус и синхронизирует `completed`
- `get_all_tasks()` / `get_task_by_id()`
- `search_tasks(query)` — поиск по `title`/`description` через `LIKE`
- `filter_tasks(...)` — фильтры (категория/приоритет/статус/диапазон дат) + сортировка по `id`
- `get_categories()`, `delete_category()`

---

### 2.3 `todo_app/main_gui.py`
Это главный UI-модуль. Он содержит:
- диалог выбора даты (`CalendarDialog`) — использует `tkcalendar`, если доступен
- диалог выбора времени (`TimePickerDialog`)
- комбинированный виджет ввода даты/времени (`DateTimeInput`)
- управление категориями (`ManageCategoriesDialog`)
- стилизованную кнопку (`ModernButton`)
- диалог редактирования задачи (`EditTaskDialog`)
- карточку/строку задачи в списке (`TaskItem`)
- панель фильтров (`FilterPanel`)
- главное приложение (`TodoApp`) и `main()` для запуска

---

## 3) Как приложение работает (поток выполнения)

### Шаг 1: Запуск
Через `run.sh` / `run.bat`:
1. проверяется наличие Python
2. при необходимости устанавливается `tkcalendar`
3. выполняется `python main_gui.py`

В `main_gui.py` вызывается `main()`, создаётся Tk-root, создаётся `TodoApp`.

---

### Шаг 2: Инициализация `TodoApp`
`TodoApp.__init__()` обычно делает:
- создаёт `TodoDatabase` → внутри вызывается `init_db()` (таблицы + категории)
- настраивает стили (`_setup_styles`)
- строит интерфейс (`_create_widgets`)
- загружает и отображает задачи (`refresh_tasks` / `_display_tasks`)

---

### Шаг 3: Добавление задачи
Пользователь вводит данные (заголовок/описание/категория/приоритет/срок) → нажимает “Добавить”.

`TodoApp._add_task()`:
1. собирает значения из полей (включая `DateTimeInput`)
2. вызывает `db.add_task(...)`
3. затем обновляет список задач (refresh/display)

---

### Шаг 4: Отображение задач
`TodoApp._display_tasks(tasks)` для каждой задачи создаёт `TaskItem` — визуальный компонент строки/карточки задачи.  
`TaskItem` отвечает за:
- отрисовку заголовка/описания/бейджей (категория/приоритет/срок)
- смену статуса (через событие) → `db.update_task_status(...)` → refresh
- редактирование (открывает `EditTaskDialog`)
- удаление (вызывает `db.delete_task(...)`)

---

### Шаг 5: Редактирование задачи
`EditTaskDialog`:
1. показывает текущие значения
2. после сохранения вызывает `db.update_task(...)`
3. дёргает callback, чтобы `TodoApp` перерисовал список

---

### Шаг 6: Фильтрация/поиск
`FilterPanel` собирает критерии (категория/приоритет/статус/поиск, и т.п.).  
`TodoApp.apply_filters()`:
- либо вызывает `db.search_tasks(query)`, либо `db.filter_tasks(...)`
- затем `_display_tasks(...)`

---

## 4) Что “склеивает” всё вместе

- **Модель:** `Task` (`core/models.py`)
- **Хранилище:** `TodoDatabase` (`core/database.py`) — единственная точка доступа к SQLite
- **GUI:** `TodoApp` и набор диалогов/виджетов (`main_gui.py`)
- **Связь GUI↔DB:** GUI вызывает методы `TodoDatabase`, получает `Task` и строит виджеты из этих данных.

---

## 5) Где смотреть реализацию

- База/CRUD: `todo_app/core/database.py`
- Модель: `todo_app/core/models.py`
- Весь интерфейс и сценарии кликов: `todo_app/main_gui.py`
- Подробный разбор по классам уже есть в: `documentation_code.md`

---

Если ты хочешь, я могу:
1) сгенерировать **ещё более структурированную** документацию (как “README”) с диаграммой зависимостей;  
2) отдельно описать **только `main_gui.py`** (пошагово по каждому классу: какие виджеты создаёт и какие события обрабатывает).
